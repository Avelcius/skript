# ==========================================
# –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ==========================================
options:
    main_world: world
    nether_world: world_nether
    center_x: 0
    center_z: 0
    start_size: 5000
    ad_open_size: 5000
    end_size: 50
    shrink_time: 900

# ==========================================
# –ó–ê–ì–†–£–ó–ö–ê –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# ==========================================
on load:
    if {hg.state} is not set:
        set {hg.state} to "waiting"
    if {hg.debug} is not set:
        set {hg.debug} to false

    clear {hg.team_name::*}
    clear {hg.team_color::*}
    clear {hg.spawns::*}
    clear {hg.valid_ids::*}

    # --- –ö–û–ú–ê–ù–î–ê 1 (red) ---
    set {_id} to "red"
    set {hg.valid_ids::%{_id}%} to true
    set {hg.team_name::%{_id}%} to "–í–∏—à–Ω–µ–≤—ã–µ –ª–∏—Å–∏—á–∫–∏"
    set {hg.team_color::%{_id}%} to "&c"
    set {hg.spawns::%{_id}%::1} to location(100, 100, 0, world "{@main_world}")
    set {hg.spawns::%{_id}%::2} to location(105, 100, 0, world "{@main_world}")
    set {hg.spawns::%{_id}%::3} to location(110, 100, 0, world "{@main_world}")
    set {hg.spawns::%{_id}%::4} to location(115, 100, 0, world "{@main_world}")

    # --- –ö–û–ú–ê–ù–î–ê 2 (blue) ---
    set {_id} to "blue"
    set {hg.valid_ids::%{_id}%} to true
    set {hg.team_name::%{_id}%} to "–õ–µ–¥—è–Ω—ã–µ –¥—Ä–∞–∫–æ–Ω—ã"
    set {hg.team_color::%{_id}%} to "&b"
    set {hg.spawns::%{_id}%::1} to location(-100, 100, 0, world "{@main_world}")
    set {hg.spawns::%{_id}%::2} to location(-105, 100, 0, world "{@main_world}")
    set {hg.spawns::%{_id}%::3} to location(-110, 100, 0, world "{@main_world}")
    set {hg.spawns::%{_id}%::4} to location(-115, 100, 0, world "{@main_world}")

    # --- –ö–û–ú–ê–ù–î–ê 3 (green) ---
    set {_id} to "green"
    set {hg.valid_ids::%{_id}%} to true
    set {hg.team_name::%{_id}%} to "???"
    set {hg.team_color::%{_id}%} to "&2"
    set {hg.spawns::%{_id}%::1} to location(0, 100, 100, world "{@main_world}")
    set {hg.spawns::%{_id}%::2} to location(0, 100, 105, world "{@main_world}")
    set {hg.spawns::%{_id}%::3} to location(0, 100, 110, world "{@main_world}")
    set {hg.spawns::%{_id}%::4} to location(0, 100, 115, world "{@main_world}")

    # --- –ö–û–ú–ê–ù–î–ê 4 (yellow) ---
    set {_id} to "yellow"
    set {hg.valid_ids::%{_id}%} to true
    set {hg.team_name::%{_id}%} to "–ü—É—à–∏—Å—Ç—ã–µ –ø–µ—á–µ–Ω—å–∫–∏"
    set {hg.team_color::%{_id}%} to "&e"
    set {hg.spawns::%{_id}%::1} to location(0, 100, -100, world "{@main_world}")
    set {hg.spawns::%{_id}%::2} to location(0, 100, -105, world "{@main_world}")
    set {hg.spawns::%{_id}%::3} to location(0, 100, -110, world "{@main_world}")
    set {hg.spawns::%{_id}%::4} to location(0, 100, -115, world "{@main_world}")

    send "&a[HG] Config loaded. Ready." to console

# ==========================================
# –ß–ê–°–¢–¨ 1: –£–ü–†–ê–í–õ–ï–ù–ò–ï
# ==========================================

command /hg <text> [<text>] [<text>]:
    permission: hg.admin
    trigger:
        # [NEW] –ö–û–ú–ê–ù–î–ê –í–´–•–û–î–ê
        if arg-1 is "leave":
            # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∞—Ä–≥—É–º–µ–Ω—Ç 2 (/hg leave Nick) - –∫–∏–∫–∞–µ–º –µ–≥–æ
            # –ï—Å–ª–∏ –Ω–µ—Ç - –∫–∏–∫–∞–µ–º —Å–µ–±—è
            set {_p} to arg-2 parsed as player
            if {_p} is not set:
                set {_p} to player
            
            if {hg.player_id::%{_p}%} is set:
                set {_old_id} to {hg.player_id::%{_p}%}
                
                # –ï—Å–ª–∏ –æ–Ω –±—ã–ª –ª–∏–¥–µ—Ä–æ–º - —É–±–∏—Ä–∞–µ–º –ª–∏–¥–µ—Ä–∫—É
                if {hg.leaders::%{_old_id}%} is {_p}:
                    delete {hg.leaders::%{_old_id}%}
                    broadcast "&e[HG] –õ–∏–¥–µ—Ä –∫–æ–º–∞–Ω–¥—ã %{_old_id}% –ø–æ–∫–∏–Ω—É–ª –ø–æ—Å—Ç."
                
                # –£–¥–∞–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ -> TAB –ø–µ—Ä–µ–∫–∏–Ω–µ—Ç –µ–≥–æ –≤ –∞–¥–º–∏–Ω—ã
                delete {hg.player_id::%{_p}%}
                delete {hg.is_leader::%{_p}%}
                
                send "&a–ò–≥—Ä–æ–∫ %{_p}% –ø–æ–∫–∏–Ω—É–ª –∫–æ–º–∞–Ω–¥—É. –¢–µ–ø–µ—Ä—å –æ–Ω –ê–¥–º–∏–Ω/–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å." to player
                if {_p} is not player:
                    send "&e–í—ã –±—ã–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –∫–æ–º–∞–Ω–¥—ã." to {_p}
            else:
                send "&c–ò–≥—Ä–æ–∫ –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç –≤ –∫–æ–º–∞–Ω–¥–µ."

        else if arg-1 is "debug":
            if {hg.debug} is false:
                set {hg.debug} to true
                send "&a[HG] &lDEBUG MODE: ON"
            else:
                set {hg.debug} to false
                send "&c[HG] &lDEBUG MODE: OFF"

        else if arg-1 is "autosetup":
            if amount of all players < 1:
                send "&c–ù—É–∂–Ω—ã –∏–≥—Ä–æ–∫–∏ –æ–Ω–ª–∞–π–Ω!"
                stop
            clear {hg.player_id::*}
            clear {hg.leaders::*}
            clear {hg.is_leader::*}
            set {_players::*} to all players
            set {_players::*} to shuffled {_players::*}
            set {_ids::*} to "red", "blue", "green" and "yellow"
            loop {_players::*}:
                if loop-index parsed as number <= 4:
                    set {_p} to loop-value
                    set {_id} to {_ids::%loop-index%}
                    set {hg.player_id::%{_p}%} to {_id}
                    set {hg.is_leader::%{_p}%} to true
                    set {hg.leaders::%{_id}%} to {_p}
                    set {_col} to {hg.team_color::%{_id}%}
                    send "&a[AUTO] %{_p}% -> %colored {_col}%%{_id}%" to console
                    send "&a–í—ã –ª–∏–¥–µ—Ä –∫–æ–º–∞–Ω–¥—ã %colored {_col}%%{_id}%" to {_p}
            send "&a[HG] –ê–≤—Ç–æ-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ."

        else if arg-1 is "join":
            set {_p} to arg-2 parsed as player
            set {_id} to arg-3
            if {_p} is set:
                if {hg.valid_ids::%{_id}%} is set:
                    set {hg.player_id::%{_p}%} to {_id}
                    delete {hg.is_leader::%{_p}%}
                    set {_name} to {hg.team_name::%{_id}%}
                    set {_col} to {hg.team_color::%{_id}%}
                    send "&a–ò–≥—Ä–æ–∫ %{_p}% –¥–æ–±–∞–≤–ª–µ–Ω –≤ %colored {_col}%%{_name}%" to player
                else:
                    send "&c–ù–µ–≤–µ—Ä–Ω—ã–π ID. (red, blue, green, yellow)"
            else:
                send "&c–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω."

        else if arg-1 is "setspawn":
            set {_id} to arg-2
            set {_num} to arg-3
            if {hg.valid_ids::%{_id}%} is set:
                if {_num} is "1" or "2" or "3" or "4":
                    set {hg.spawns::%{_id}%::%{_num}%} to location of player
                    send "&a–°–ø–∞–≤–Ω ##%{_num}% –¥–ª—è &e%{_id}% &a—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
                else:
                    send "&c–°–ª–æ—Ç 1-4."
            else:
                send "&c–ù–µ–≤–µ—Ä–Ω—ã–π ID."

        else if arg-1 is "leader":
            set {_p} to arg-2 parsed as player
            if {_p} is set:
                set {_id} to {hg.player_id::%{_p}%}
                if {_id} is set:
                    loop all players:
                        if {hg.player_id::%loop-player%} is {_id}:
                            delete {hg.is_leader::%loop-player%}
                    set {hg.is_leader::%{_p}%} to true
                    set {hg.leaders::%{_id}%} to {_p}
                    set {_col} to {hg.team_color::%{_id}%}
                    broadcast "&6–õ–∏–¥–µ—Ä–æ–º %colored {_col}%%{_id}% &6–Ω–∞–∑–Ω–∞—á–µ–Ω %{_p}%!"
                else:
                    send "&c–£ –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–∞–Ω–¥—ã."
            else:
                send "&c–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω."
                
        else:
            send "&6--- HG Admin v14.0 ---"
            send "&e/hg leave [Nick] &7- –í—ã–π—Ç–∏ –∏–∑ –∫–æ–º–∞–Ω–¥—ã"
            send "&e/hg debug"
            send "&e/hg autosetup"
            send "&e/hg join <Nick> <ID>"
            send "&e/hg leader <Nick>"
            send "&e/hgstart /hgstop"

# ==========================================
# –ß–ê–°–¢–¨ 2: –°–¢–ê–†–¢
# ==========================================

command /hgstart:
    permission: hg.admin
    trigger:
        if {hg.state} is not "waiting":
            send "&c–ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç!"
            stop
            
        loop all players:
            if {hg.player_id::%loop-player%} is set:
                set {_id} to {hg.player_id::%loop-player%}
                if {hg.leaders::%{_id}%} is not set:
                    send "&c–û–®–ò–ë–ö–ê: –£ –∫–æ–º–∞–Ω–¥—ã ID %{_id}% –Ω–µ—Ç –ª–∏–¥–µ—Ä–∞!" to player
                    stop

        set {hg.state} to "starting"
        
        if {hg.debug} is true:
            set {_time_pvp} to 10 seconds
            set {_time_nether_open} to 10 seconds
            set {_time_nether_close} to 10 seconds
            set {_time_end} to 10 seconds
            set {_shrink_duration} to 10
        else:
            set {_time_pvp} to 5 minutes
            set {_time_nether_open} to 15 minutes
            set {_time_nether_close} to 20 minutes
            set {_time_end} to 10 minutes
            set {_shrink_duration} to {@shrink_time}

        execute console command "gamerule doImmediateRespawn true"
        execute console command "gamerule keepInventory true"
        execute console command "time set 0"
        execute console command "worldborder center {@center_x} {@center_z}"
        execute console command "worldborder set {@start_size}"

        clear {_slots::*}
        loop all players:
            if {hg.player_id::%loop-player%} is set:
                set {_id} to {hg.player_id::%loop-player%}
                
                if {_slots::%{_id}%} is not set:
                    set {_slots::%{_id}%} to 1
                else:
                    add 1 to {_slots::%{_id}%}
                set {_current_slot} to {_slots::%{_id}%}
                if {_current_slot} > 4:
                    set {_current_slot} to 1
                
                if {hg.spawns::%{_id}%::%{_current_slot}%} is set:
                    teleport loop-player to {hg.spawns::%{_id}%::%{_current_slot}%}
                else:
                    teleport loop-player to {hg.spawns::%{_id}%::1}
                
                apply potion of slowness of tier 255 without particles to loop-player for 999 seconds
                apply potion of jump boost of tier 250 without particles to loop-player for 999 seconds
                apply potion of mining fatigue of tier 255 without particles to loop-player for 999 seconds
                heal loop-player
                set food level of loop-player to 10
            else:
                set gamemode of loop-player to spectator

        send title "&e&l–ü–†–ò–ì–û–¢–û–í–¨–¢–ï–°–¨" with subtitle "&7–ß–∏—Ç–∞–π—Ç–µ —á–∞—Ç!" to all players for 2 seconds
        broadcast ""
        broadcast "&8&m========================================"
        broadcast "             &6&lHUNGER GAMES"
        broadcast "&8&m========================================"
        play sound "ui.button.click" with volume 1 to all players
        wait 5 seconds
        
        send title "&a&l–ú–ò–†–ù–û–ï –í–†–ï–ú–Ø" with subtitle "&7–ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç" to all players for 2 seconds
        broadcast ""
        broadcast "&a&l–≠–¢–ê–ü 1: –†–ê–ó–í–ò–¢–ò–ï"
        broadcast "&e1. &fPvP –æ—Ç–∫–ª—é—á–µ–Ω–æ."
        broadcast "&e2. &f–í–µ—â–∏ –Ω–µ –≤—ã–ø–∞–¥–∞—é—Ç."
        play sound "entity.experience_orb.pickup" with volume 1 to all players
        wait 5 seconds
        
        send title "&4&l–ó–ê–©–ò–©–ê–ô –õ–ò–î–ï–†–ê" with subtitle "&7–°–º–µ—Ä—Ç—å –ª–∏–¥–µ—Ä–∞ = –ü–µ—Ä–º–∞-—Å–º–µ—Ä—Ç—å" to all players for 2 seconds
        broadcast ""
        broadcast "&c&l–ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û"
        broadcast "&4&l–õ–ò–î–ï–† &f‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å –∫–æ–º–∞–Ω–¥—ã."
        broadcast "&c–£–º—Ä–µ—Ç –õ–∏–¥–µ—Ä ‚Äî –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–∞—Ç—Å—è!"
        play sound "block.note_block.pling" with volume 1 to all players
        wait 2 seconds
        
        loop 3 times:
            set {_count} to 4 - loop-number
            send title "&c&l%{_count}%" with subtitle "" to all players for 0.5 seconds
            broadcast "&e–°—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑: &c&l%{_count}%..."
            play sound "ui.button.click" with volume 2 to all players
            wait 1 second

        set {hg.state} to "running"
        set {hg.start_time} to now
        set {hg.pvp} to false
        set {hg.nether} to false
        set {hg.respawn_global} to true
        
        loop all players:
            if {hg.player_id::%loop-player%} is set:
                remove slowness from loop-player
                remove jump boost from loop-player
                remove mining fatigue from loop-player
                give compass to loop-player
        
        broadcast "&a&l–ò–ì–†–ê –ù–ê–ß–ê–õ–ê–°–¨! –í–ü–ï–†–ï–î!"
        play sound "entity.ender_dragon.growl" with volume 1 to all players
        
        wait {_time_pvp}
        if {hg.state} is "running":
            set {hg.pvp} to true
            execute console command "gamerule keepInventory false"
            broadcast ""
            broadcast "&c&lPvP –í–ö–õ–Æ–ß–ï–ù–û! KeepInventory –í–´–ö–õ–Æ–ß–ï–ù!"
        
        wait {_time_nether_open}
        if {hg.state} is "running":
            set {hg.nether} to true
            execute console command "worldborder set {@ad_open_size}"
            broadcast ""
            broadcast "&4&l–ê–î –û–¢–ö–†–´–õ–°–Ø! &7–ú–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Ä—Ç–∞–ª—ã."
        
        wait {_time_nether_close}
        if {hg.state} is "running":
            set {hg.nether} to false
            broadcast ""
            broadcast "&4&l–ê–î –ó–ê–ö–†–´–¢! &c–í—Å–µ –≤–Ω—É—Ç—Ä–∏ –ø–æ–≥–∏–±–ª–∏."
            loop all players:
                if "%world of loop-player%" is "{@nether_world}":
                    send "&c–í—ã –Ω–µ —É—Å–ø–µ–ª–∏ –≤—ã–π—Ç–∏." to loop-player
                    kill loop-player

        wait {_time_end}
        if {hg.state} is "running":
            set {hg.respawn_global} to false
            execute console command "worldborder set {@end_size} %{_shrink_duration}%"
            broadcast ""
            broadcast "&c&l–°–£–î–ù–ê–Ø –ù–û–ß–¨! &4–†–ï–°–ü–ê–í–ù –û–¢–ö–õ–Æ–ß–ï–ù! &c–ë–ê–†–¨–ï–† –ï–î–ï–¢!"

# ==========================================
# –ß–ê–°–¢–¨ 3: –ì–ï–ô–ú–ü–õ–ï–ô
# ==========================================

on player portal:
    if {hg.state} is "running":
        if {hg.nether} is false:
            cancel event
            send "&c‚õî &l–ê–î –ó–ê–ö–†–´–¢!" to player

on right click with compass:
    if {hg.state} is "running":
        if {hg.player_id::%player%} is set:
            set {_id} to {hg.player_id::%player%}
            if {hg.leaders::%{_id}%} is set:
                set compass target of player to location of {hg.leaders::%{_id}%}
                send "&a–ö–æ–º–ø–∞—Å -> –õ–∏–¥–µ—Ä." to player
            else:
                send "&c–õ–∏–¥–µ—Ä –º–µ—Ä—Ç–≤! –ö–æ–º–ø–∞—Å -> –¶–µ–Ω—Ç—Ä." to player
                set compass target of player to location({@center_x}, 60, {@center_z}, world "{@main_world}")

on damage:
    if {hg.state} is "running":
        if {hg.pvp} is false:
            if attacker is a player:
                if victim is a player:
                    cancel event
                    send "&cüõ° PvP –æ—Ç–∫–ª—é—á–µ–Ω–æ!" to attacker

on death of player:
    if {hg.state} is "running":
        if {hg.player_id::%victim%} is set:
            wait 1 tick
            set {_id} to {hg.player_id::%victim%}
            set {_leader} to {hg.leaders::%{_id}%}
            
            set {_team_name} to {hg.team_name::%{_id}%}
            set {_col} to {hg.team_color::%{_id}%}
            
            if victim is {_leader}:
                broadcast ""
                broadcast "&4&l‚ö° –£–ë–ò–¢ –õ–ò–î–ï–† %colored {_col}%%{_team_name}% &8(%victim%)!"
                broadcast "&c–¢–µ–ø–µ—Ä—å –∏–≥—Ä–æ–∫–∏ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –ù–ï –≤–æ–∑—Ä–æ–∂–¥–∞—é—Ç—Å—è!"
                play sound "entity.lightning_bolt.thunder" with volume 100 to all players
                delete {hg.leaders::%{_id}%}
                set gamemode of victim to spectator
            else:
                if {hg.respawn_global} is true:
                    if {hg.leaders::%{_id}%} is set:
                        send "&e–õ–∏–¥–µ—Ä –∂–∏–≤! –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥..." to victim
                        set gamemode of victim to spectator
                        wait 5 seconds
                        if {hg.leaders::%{_id}%} is set:
                            set gamemode of victim to survival
                            teleport victim to {hg.leaders::%{_id}%}
                        else:
                            send "&c–õ–∏–¥–µ—Ä –ø–æ–≥–∏–±. –ö–æ–Ω–µ—Ü." to victim
                    else:
                        send "&c–í–∞—à –ª–∏–¥–µ—Ä –º–µ—Ä—Ç–≤. –í—ã –≤—ã–±—ã–ª–∏." to victim
                        set gamemode of victim to spectator
                else:
                    send "&c–í—Ä–µ–º—è –≤—ã—à–ª–æ. –í—ã –≤—ã–±—ã–ª–∏." to victim
                    set gamemode of victim to spectator

placeholderapi placeholder with the prefix "hg":
    if the identifier is "team":
        set {_id} to {hg.player_id::%player%}
        set the result to {hg.team_name::%{_id}%} ? ""
    
    # –í–û–ó–í–†–ê–©–ê–ï–¢ red, blue, green, yellow –∏–ª–∏ none (–í–ê–ñ–ù–û –î–õ–Ø TAB!)
    if the identifier is "id":
        set the result to {hg.player_id::%player%} ? "none"

    if the identifier starts with "teamname_":
        set {_target_id} to the identifier
        replace all "teamname_" with "" in {_target_id}
        if {hg.team_name::%{_target_id}%} is set:
            set {_n} to {hg.team_name::%{_target_id}%}
            set {_c} to {hg.team_color::%{_target_id}%}
            set the result to "%colored {_c}%&l%{_n}%"
        else:
            set the result to "&7%{_target_id}%"

    if the identifier is "color":
        set {_id} to {hg.player_id::%player%}
        set the result to {hg.team_color::%{_id}%} ? "&7"
    if the identifier is "prefix":
        set {_id} to {hg.player_id::%player%}
        set {_c} to {hg.team_color::%{_id}%} ? "&7"
        if {hg.is_leader::%player%} is true:
            set the result to "%colored {_c}%[L] "
        else:
            set the result to colored {_c}

command /hgstop:
    permission: hg.admin
    trigger:
        set {hg.state} to "waiting"
        execute console command "gamerule doImmediateRespawn false"
        execute console command "gamerule keepInventory false"
        broadcast "&c–ò–≥—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."
        loop all players:
            remove slowness from loop-player
            remove jump boost from loop-player
            remove mining fatigue from loop-player
            set gamemode of loop-player to survival
            teleport loop-player to location({@center_x}, 100, {@center_z}, world "{@main_world}")
